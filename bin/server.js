// Generated by CoffeeScript 1.8.0
(function() {
  'use strict';
  var BadRequest, Boom, Hapi, Server, join;

  Hapi = require('hapi');

  Boom = require('boom');

  BadRequest = Boom.badRequest;

  join = require('path').join;

  Server = (function() {
    function Server() {
      this.server = new Hapi.Server();
      this.server.connection({
        host: '0.0.0.0',
        port: process.env.PORT || 4545
      });
      this._names();
    }

    Server.prototype._names = function() {
      return this.server.route({
        method: 'GET',
        path: '/names',
        handler: (function(_this) {
          return function(req, reply) {
            if (!_this.snippetNames) {
              return reply(BadRequest('Server Has not been started!'));
            }
            return reply(_this.snippetNames);
          };
        })(this)
      });
    };


    /*
    The required path is relative to this module...
     */

    Server.prototype._configure = function(context, path) {
      this.requiredFile = context.require(path);
      console.log('file', path);
      console.log('file', this.requiredFile);
      this.snippetNames = Object.keys(this.requiredFile);
      return this._setupRoutes();
    };

    Server.prototype._setupRoutes = function() {
      return this.server.route({
        method: ['PUT', 'POST', 'GET'],
        path: '/snippet/{name}',
        handler: (function(_this) {
          return function(req, reply) {
            var snippet;
            snippet = _this.requiredFile[req.params.name];
            if (!snippet) {
              return reply(BadRequest('Snippet Not Found!'));
            }
            return snippet(req, reply);
          };
        })(this)
      });
    };

    Server.prototype.start = function(context, path, cb) {
      if (!path) {
        throw Error('No Path Given!');
      }
      this._configure(context, path);
      return this.server.start((function(_this) {
        return function(err) {
          console.log('Server started at: ' + _this.server.info.uri);
          if (cb) {
            return cb(err);
          }
        };
      })(this));
    };

    return Server;

  })();

  module.exports = new Server();

}).call(this);
